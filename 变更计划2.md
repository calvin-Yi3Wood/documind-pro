阶段 1：本地存储降级 + DeepSeek 双模型

提示词 1.1 - 存储层降级（跳过 Supabase）

为 documind-pro 项目实现存储层降级方案，暂时不使用 Supabase。



任务：

1\. 修改 services/storage/index.ts

&nbsp;  - 默认使用 LocalStorageProvider

&nbsp;  - 添加环境变量检查：只有配置了 SUPABASE\_URL 才使用 Supabase

&nbsp;  - 确保本地存储完全可用



2\. 修改 lib/supabase/server.ts

&nbsp;  - 添加空值检查，如果未配置 Supabase 则返回 mock 客户端

&nbsp;  - 不要抛出错误，而是优雅降级



3\. 修改 middleware.ts

&nbsp;  - 确保 NEXT\_PUBLIC\_DEV\_MODE=true 时完全跳过认证

&nbsp;  - 开发模式下所有功能可用



4\. 修改 services/quota/index.ts

&nbsp;  - 开发模式下跳过配额检查

&nbsp;  - 返回无限配额



5\. 更新 .env.example 添加说明：



开发模式（跳过认证和 Supabase）

NEXT\_PUBLIC\_DEV\_MODE=true



Supabase（可选，不配置则使用本地存储）

NEXT\_PUBLIC\_SUPABASE\_URL=

SUPABASE\_SERVICE\_ROLE\_KEY=



目标：项目在没有 Supabase 的情况下可以完整运行。



提示词 1.2 - DeepSeek 双模型完整支持

为 documind-pro 项目完善 DeepSeek API 支持，实现双模型切换。



参考原项目：/home/user/documind-ai-agent/services/deepseekService.ts



任务：



1\. 完善 services/ai/deepseek.ts

&nbsp;  - 支持两个模型：

&nbsp;    - deepseek-chat（V3 标准模型，快速）

&nbsp;    - deepseek-reasoner（R1 思考模型，包含推理过程）

&nbsp;  - 实现流式响应（SSE）

&nbsp;  - 支持思考过程提取（reasoner 模型的 reasoning\_content）

&nbsp;  - API 端点：https://api.deepseek.com/chat/completions



2\. 修改 services/ai/provider.ts

&nbsp;  - AIProviderManager 支持模型切换

&nbsp;  - 添加 setModel(provider: 'gemini' | 'deepseek', model?: string) 方法

&nbsp;  - 支持运行时切换模型



3\. 修改 app/api/ai/chat/route.ts

&nbsp;  - 接收 provider 和 model 参数

&nbsp;  - 支持前端指定使用哪个 AI 服务

&nbsp;  - 示例请求：

&nbsp;    ```json

&nbsp;    {

&nbsp;      "query": "...",

&nbsp;      "provider": "deepseek",

&nbsp;      "model": "deepseek-reasoner"

&nbsp;    }

&nbsp;    ```



4\. 创建 types/ai.ts（如果不存在）

&nbsp;  - 定义 AI 相关类型

&nbsp;  - AIProvider 类型

&nbsp;  - AIModel 类型

&nbsp;  - 包含 DeepSeek 的思考过程类型



5\. 更新 config/prompts.ts

&nbsp;  - 添加 DeepSeek 专用的系统提示词

&nbsp;  - Reasoner 模型的特殊提示词



DeepSeek API 格式参考：

```typescript

// 请求

{

&nbsp; model: "deepseek-chat" | "deepseek-reasoner",

&nbsp; messages: \[{ role: "user", content: "..." }],

&nbsp; stream: true

}



// Reasoner 模型响应（包含思考过程）

{

&nbsp; choices: \[{

&nbsp;   message: {

&nbsp;     reasoning\_content: "思考过程...",

&nbsp;     content: "最终答案..."

&nbsp;   }

&nbsp; }]

}



确保 DeepSeek 和 Gemini 可以无缝切换使用。





---



\## 阶段 2：核心组件迁移



\### 提示词 2.1 - Editor 组件迁移





将原项目的 Editor 组件迁移到 documind-pro。



源文件：/home/user/documind-ai-agent/components/Editor.tsx（约 1800 行）

目标：/home/user/documind-pro/components/features/editor/



任务：



分析原项目 Editor.tsx 的功能结构：



工具栏功能

富文本编辑逻辑

图片处理

格式化命令

历史记录（Undo/Redo）

文档大纲

按模块拆分迁移到：

components/features/editor/

├── index.tsx # 主编辑器（整合所有子组件）

├── Toolbar.tsx # 工具栏（格式按钮）

├── BlockMenu.tsx # 块级菜单

├── ImageHandler.tsx # 图片处理逻辑

├── OutlinePanel.tsx # 文档大纲

└── hooks/

├── useEditorState.ts # 编辑器状态管理

├── useHistory.ts # Undo/Redo 逻辑

└── useSelection.ts # 选区管理



适配新架构：



使用 @/components/ui/\* 基础组件

使用 @/lib/security/sanitize 进行 XSS 防护

所有 dangerouslySetInnerHTML 必须经过 sanitize

使用 Zustand 管理状态（如果需要）

保持原有功能：



加粗、斜体、下划线、删除线

标题 H1-H6

有序/无序列表

引用、代码块

图片插入（拖拽、粘贴、选择）

表格

对齐方式

撤销/重做

样式适配：



使用 Tailwind CSS

保持原项目的视觉风格（cream/bronze 配色）

删除当前的占位 Editor.tsx，替换为完整实现。





---



\### 提示词 2.2 - FloatingAgent 组件迁移





将原项目的 FloatingAgent 组件迁移到 documind-pro。



源文件：/home/user/documind-ai-agent/components/FloatingAgent.tsx（约 2000 行）

目标：/home/user/documind-pro/components/features/ai-assistant/



任务：



分析原项目 FloatingAgent.tsx 的功能：



AI 对话（流式响应）

模型切换（Gemini/DeepSeek）

消息历史

图片生成

文件上传解析

网络搜索集成

按模块拆分迁移到：

components/features/ai-assistant/

├── index.tsx # 主容器（FloatingAgent）

├── ChatPanel.tsx # 聊天面板

├── MessageList.tsx # 消息列表

├── MessageItem.tsx # 单条消息（支持 Markdown 渲染）

├── InputArea.tsx # 输入区域

├── ModelSwitcher.tsx # 模型切换器（Gemini/DeepSeek 双模型）

├── ImagePreview.tsx # 图片预览

├── ThinkingDisplay.tsx # DeepSeek Reasoner 思考过程显示（新增）

└── hooks/

├── useChat.ts # 聊天逻辑

├── useStreaming.ts # 流式响应处理

└── useModelSwitch.ts # 模型切换逻辑



关键改动 - API 调用改为后端代理：



原代码（直接调用 API）：



// 不要这样做

const response = await fetch('https://api.deepseek.com/...', {

&nbsp; headers: { Authorization: `Bearer ${apiKey}` }

});



新代码（通过后端代理）：



// 正确做法

const response = await fetch('/api/ai/chat', {

&nbsp; method: 'POST',

&nbsp; body: JSON.stringify({

&nbsp;   query: message,

&nbsp;   provider: 'deepseek',      // 或 'gemini'

&nbsp;   model: 'deepseek-reasoner', // 或 'deepseek-chat'

&nbsp;   history: chatHistory,

&nbsp;   stream: true

&nbsp; })

});



模型切换 UI：



添加模型选择下拉菜单

支持：Gemini Flash、DeepSeek Chat、DeepSeek Reasoner

显示当前使用的模型

Reasoner 模型时显示思考过程

移除前端 API Key 逻辑：



删除所有 localStorage 存储 API Key 的代码

删除 API Key 输入框

API Key 完全由后端管理

保持原有功能：



流式响应显示

消息编辑（双击编辑）

消息复制

清空历史

Markdown 渲染

删除当前的占位 FloatingAgent.tsx，替换为完整实现。





---



\### 提示词 2.3 - Skills 对接实际 API





将 documind-pro 的 Skills 执行逻辑从占位符改为实际调用后端 API。



任务：



修改 skills/ai-chat/executor.ts



删除占位符代码

实际调用 /api/ai/chat

支持流式响应

返回真实 AI 回复

修改 skills/image-generation/executor.ts



调用 /api/ai/image（需要先确认此 API 存在）

如果 API 不存在，创建 app/api/ai/image/route.ts

使用 Gemini 的图片生成能力

修改 skills/document-analysis/executor.ts



调用 /api/ai/chat 进行文档分析

构建专门的分析提示词

返回结构化的分析结果

修改 skills/visualization/executor.ts



调用 /api/ai/chat 生成可视化配置

返回 Chart.js 或 Mermaid 配置

前端根据配置渲染图表

修改 skills/web-search/executor.ts



调用 /api/search

返回真实搜索结果

修改 app/api/skills/\[skillId]/route.ts



导入并使用实际的 Skill 执行器

而不是硬编码占位符响应

确保所有 Skills 都能正常工作，返回真实数据。





---



\## 阶段 3：其他组件迁移



\### 提示词 3.1 - VisualPanel 迁移





将原项目的可视化组件迁移到 documind-pro。



源文件：/home/user/documind-ai-agent/components/VisualPanel.tsx

目标：/home/user/documind-pro/components/features/visual/



任务：



迁移 Chart.js 图表功能



修改 ChartViewer.tsx

支持柱状图、折线图、饼图、雷达图

从 CDN 加载 Chart.js（参考原项目 index.html）

迁移 Mermaid 思维导图功能



修改 VisualPanel.tsx 或创建 MindmapView.tsx

从 CDN 加载 Mermaid.js

保持原项目的深蓝网格背景样式

迁移 DrawingCanvas



实现画布绘图功能

支持画笔、橡皮擦、颜色选择

确保所有外部库通过 CDN 加载



在 app/layout.tsx 或 next.config.ts 中配置 CDN 脚本

或者使用动态导入

保持原项目的专业视觉效果。





---



\### 提示词 3.2 - KnowledgeBase 迁移





将原项目的知识库组件迁移到 documind-pro。



源文件：/home/user/documind-ai-agent/components/KnowledgeBase.tsx

目标：/home/user/documind-pro/components/features/knowledge/



任务：



迁移文件上传功能



支持 PDF、Word、Excel、Markdown

使用 CDN 加载解析库（PDF.js、Mammoth.js、SheetJS）

迁移文件解析逻辑



PDF 文本提取

Word 文档解析

Excel 表格解析

迁移资料管理 UI



资料列表

启用/禁用切换

删除功能

存储适配



暂时使用 localStorage/IndexedDB

预留 Supabase Storage 接口

保持与原项目相同的功能和 UI。





---



\## 阶段 4：主页面集成



\### 提示词 4.1 - Dashboard 三栏布局





完善 documind-pro 的主页面布局。



目标文件：app/(dashboard)/dashboard/page.tsx



任务：



实现三栏布局（参考原项目 App.tsx）：

┌─────────────┬──────────────────┬─────────────┐

│ 知识库 │ 编辑器 │ AI 助手 │

│ (左侧边栏) │ (主编辑区) │ (右侧边栏) │

│ 可调整宽度 │ │ 可调整宽度 │

└─────────────┴──────────────────┴─────────────┘



集成已迁移的组件：



KnowledgeBase（左侧）

Editor（中间）

FloatingAgent（右侧，或浮动按钮）

实现宽度调整：



左右侧边栏可拖拽调整宽度

保存用户偏好到 localStorage

状态管理：



使用 Zustand 创建全局状态

文档状态

AI 上下文

知识库来源

快捷键支持：



Ctrl+Z / Cmd+Z 撤销

Ctrl+Y / Cmd+Y 重做

Ctrl+S / Cmd+S 保存

创建一个可用的完整工作界面。





---



\## 阶段 5：环境配置



\### 提示词 5.1 - 最终配置





完成 documind-pro 的最终配置。



任务：



创建 .env.local 模板并填写说明：



\# ============================================

\# DocuMind Pro 环境配置

\# ============================================



\# 开发模式（跳过认证）

NEXT\_PUBLIC\_DEV\_MODE=true



\# AI 服务（至少配置一个）

GEMINI\_API\_KEY=你的Gemini密钥

DEEPSEEK\_API\_KEY=你的DeepSeek密钥



\# 默认 AI 模型

DEFAULT\_AI\_PROVIDER=deepseek

DEFAULT\_DEEPSEEK\_MODEL=deepseek-chat



\# NextAuth（开发模式下可选）

NEXTAUTH\_SECRET=随机字符串

NEXTAUTH\_URL=http://localhost:3000



\# Supabase（可选，不配置则使用本地存储）

\# NEXT\_PUBLIC\_SUPABASE\_URL=

\# SUPABASE\_SERVICE\_ROLE\_KEY=



更新 package.json scripts：



添加 "dev:local" 脚本（本地开发，无需外部服务）

确保项目可以启动：



npm run dev 正常运行

访问 http://localhost:3000/dashboard

AI 对话功能正常

模型切换正常

创建 README 使用说明（更新现有 README）



让项目在最小配置下可以运行。





---



\## 执行顺序





步骤 1: 提示词 1.1 → 存储层降级（5 分钟）

步骤 2: 提示词 1.2 → DeepSeek 双模型（15 分钟）

步骤 3: 提示词 2.1 → Editor 迁移（30 分钟）

步骤 4: 提示词 2.2 → FloatingAgent 迁移（30 分钟）

步骤 5: 提示词 2.3 → Skills 对接 API（15 分钟）

步骤 6: 提示词 3.1 → VisualPanel 迁移（20 分钟）

步骤 7: 提示词 3.2 → KnowledgeBase 迁移（15 分钟）

步骤 8: 提示词 4.1 → Dashboard 集成（20 分钟）

步骤 9: 提示词 5.1 → 最终配置（5 分钟）



预计总时间：约 2.5 小时





---



你可以按顺序执行这些提示词。每完成一个步骤建议运行 `npm run dev` 测试一下，确保没有错误再继续下一步。



